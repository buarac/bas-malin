# F1.4 - Design System & Composants UI

**Score Priorité :** 85/100  
**Statut :** PRIORITÉ ÉLEVÉE  
**Epic :** EPIC 1 - FONDATIONS  
**Effort estimé :** 20 jours  

## Description

Design system cohérent et extensible pour Baš-Malin avec composants UI adaptatifs multi-device, théming avancé, accessibilité WCAG 2.1 AA et documentation interactive complète.

## User Stories

### US1.4.1 - Cohérence Visuelle Multi-Device
**En tant qu'** utilisateur expert  
**Je veux** une interface cohérente sur tous mes appareils  
**Afin de** naviguer intuitivement sans réapprendre l'interface  

**Critères d'acceptation :**
- Design tokens unifiés (couleurs, typographie, espacements)
- Composants adaptatifs automatiques selon l'écran
- Continuité visuelle entre Mobile, Desktop et TV
- Animation et micro-interactions cohérentes
- Thème sombre/clair avec transition fluide

### US1.4.2 - Accessibilité Universelle
**En tant qu'** utilisateur avec des besoins spécifiques  
**Je veux** une interface accessible et inclusive  
**Afin de** utiliser l'application sans barrière  

**Critères d'acceptation :**
- Navigation clavier complète (Tab, Arrow keys)
- Support lecteur d'écran (ARIA, semantic HTML)
- Contraste couleurs conforme WCAG 2.1 AA
- Tailles de texte configurables
- Mode haut contraste disponible

### US1.4.3 - Personnalisation Avancée
**En tant qu'** utilisateur occasionnel  
**Je veux** personnaliser l'interface selon mes préférences  
**Afin de** avoir une expérience adaptée à mes besoins  

**Critères d'acceptation :**
- Thèmes personnalisables (couleurs principales)
- Taille d'interface configurable (compact/confortable/large)
- Mode expert/simple avec complexité adaptée
- Raccourcis personnalisables
- Sauvegarde préférences multi-device

## Architecture Technique

### Design Tokens & Theming

```typescript
// src/design-system/tokens/tokens.ts
export const designTokens = {
  // Couleurs principales
  colors: {
    // Palette primaire - Nature & Jardin
    primary: {
      50: '#f0fdf4',   // Vert très clair
      100: '#dcfce7',  // Vert pastel
      200: '#bbf7d0',  // Vert clair
      300: '#86efac',  // Vert moyen clair
      400: '#4ade80',  // Vert moyen
      500: '#22c55e',  // Vert principal
      600: '#16a34a',  // Vert foncé
      700: '#15803d',  // Vert très foncé
      800: '#166534',  // Vert sombre
      900: '#14532d',  // Vert très sombre
      950: '#052e16'   // Vert quasi-noir
    },
    
    // Palette secondaire - Terre & Bois
    secondary: {
      50: '#fefce8',   // Beige très clair
      100: '#fef3c7',  // Beige clair
      200: '#fde68a',  // Jaune beige
      300: '#fcd34d',  // Jaune terre
      400: '#fbbf24',  // Orange terre
      500: '#f59e0b',  // Orange principal
      600: '#d97706',  // Orange foncé
      700: '#b45309',  // Brun orange
      800: '#92400e',  // Brun foncé
      900: '#78350f',  // Brun très foncé
      950: '#451a03'   // Brun quasi-noir
    },
    
    // Statuts & États
    success: {
      light: '#dcfce7',
      DEFAULT: '#22c55e',
      dark: '#15803d'
    },
    warning: {
      light: '#fef3c7',
      DEFAULT: '#f59e0b',
      dark: '#d97706'
    },
    error: {
      light: '#fee2e2',
      DEFAULT: '#ef4444',
      dark: '#dc2626'
    },
    info: {
      light: '#dbeafe',
      DEFAULT: '#3b82f6',
      dark: '#1d4ed8'
    },
    
    // Gris & Neutres
    gray: {
      50: '#f9fafb',
      100: '#f3f4f6',
      200: '#e5e7eb',
      300: '#d1d5db',
      400: '#9ca3af',
      500: '#6b7280',
      600: '#4b5563',
      700: '#374151',
      800: '#1f2937',
      900: '#111827',
      950: '#030712'
    }
  },
  
  // Typographie
  typography: {
    fontFamily: {
      sans: ['Inter', 'system-ui', 'sans-serif'],
      mono: ['JetBrains Mono', 'Consolas', 'monospace'],
      display: ['Poppins', 'Inter', 'sans-serif']
    },
    fontSize: {
      xs: ['0.75rem', { lineHeight: '1rem' }],
      sm: ['0.875rem', { lineHeight: '1.25rem' }],
      base: ['1rem', { lineHeight: '1.5rem' }],
      lg: ['1.125rem', { lineHeight: '1.75rem' }],
      xl: ['1.25rem', { lineHeight: '1.75rem' }],
      '2xl': ['1.5rem', { lineHeight: '2rem' }],
      '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
      '4xl': ['2.25rem', { lineHeight: '2.5rem' }],
      '5xl': ['3rem', { lineHeight: '1' }],
      '6xl': ['3.75rem', { lineHeight: '1' }]
    }
  },
  
  // Espacements & Tailles
  spacing: {
    px: '1px',
    0: '0',
    0.5: '0.125rem',  // 2px
    1: '0.25rem',     // 4px
    1.5: '0.375rem',  // 6px
    2: '0.5rem',      // 8px
    2.5: '0.625rem',  // 10px
    3: '0.75rem',     // 12px
    3.5: '0.875rem',  // 14px
    4: '1rem',        // 16px
    5: '1.25rem',     // 20px
    6: '1.5rem',      // 24px
    7: '1.75rem',     // 28px
    8: '2rem',        // 32px
    9: '2.25rem',     // 36px
    10: '2.5rem',     // 40px
    12: '3rem',       // 48px
    16: '4rem',       // 64px
    20: '5rem',       // 80px
    24: '6rem',       // 96px
    32: '8rem',       // 128px
    40: '10rem',      // 160px
    48: '12rem',      // 192px
    56: '14rem',      // 224px
    64: '16rem'       // 256px
  },
  
  // Bordures & Rayons
  borderRadius: {
    none: '0',
    sm: '0.125rem',   // 2px
    DEFAULT: '0.25rem', // 4px
    md: '0.375rem',   // 6px
    lg: '0.5rem',     // 8px
    xl: '0.75rem',    // 12px
    '2xl': '1rem',    // 16px
    '3xl': '1.5rem',  // 24px
    full: '9999px'
  },
  
  // Ombres
  boxShadow: {
    sm: '0 1px 2px 0 rgb(0 0 0 / 0.05)',
    DEFAULT: '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',
    md: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',
    lg: '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',
    xl: '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)',
    '2xl': '0 25px 50px -12px rgb(0 0 0 / 0.25)',
    inner: 'inset 0 2px 4px 0 rgb(0 0 0 / 0.05)'
  },
  
  // Animations & Transitions
  transitionDuration: {
    DEFAULT: '150ms',
    75: '75ms',
    100: '100ms',
    150: '150ms',
    200: '200ms',
    300: '300ms',
    500: '500ms',
    700: '700ms',
    1000: '1000ms'
  },
  
  // Breakpoints responsive
  screens: {
    xs: '475px',
    sm: '640px',    // Mobile large
    md: '768px',    // Tablet
    lg: '1024px',   // Desktop
    xl: '1280px',   // Desktop large
    '2xl': '1536px', // Desktop XL
    tv: '1920px'    // TV 1080p+
  }
} as const;

// Types TypeScript générés
export type ColorScale = keyof typeof designTokens.colors.primary;
export type FontSize = keyof typeof designTokens.typography.fontSize;
export type Spacing = keyof typeof designTokens.spacing;
export type BorderRadius = keyof typeof designTokens.borderRadius;
```

### Système de Thèmes

```typescript
// src/design-system/themes/theme-provider.tsx
import { createContext, useContext, useEffect, useState } from 'react';

export type ThemeMode = 'light' | 'dark' | 'auto';
export type ThemeSize = 'compact' | 'comfortable' | 'large';
export type ThemeContrast = 'normal' | 'high';

export interface ThemeConfig {
  mode: ThemeMode;
  size: ThemeSize;
  contrast: ThemeContrast;
  primaryColor: string;
  customizations: Record<string, any>;
}

export interface ThemeContextValue {
  theme: ThemeConfig;
  setTheme: (theme: Partial<ThemeConfig>) => void;
  toggleMode: () => void;
  isLoading: boolean;
}

const ThemeContext = createContext<ThemeContextValue | undefined>(undefined);

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [theme, setThemeState] = useState<ThemeConfig>({
    mode: 'auto',
    size: 'comfortable',
    contrast: 'normal',
    primaryColor: designTokens.colors.primary[500],
    customizations: {}
  });
  const [isLoading, setIsLoading] = useState(true);

  // Chargement des préférences utilisateur
  useEffect(() => {
    const loadThemePreferences = async () => {
      try {
        const saved = localStorage.getItem('bas-malin-theme');
        if (saved) {
          const savedTheme = JSON.parse(saved);
          setThemeState(prev => ({ ...prev, ...savedTheme }));
        }
        
        // Synchronisation avec les préférences système
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        const handleSystemThemeChange = (e: MediaQueryListEvent) => {
          if (theme.mode === 'auto') {
            applyThemeToDOM({ ...theme, mode: e.matches ? 'dark' : 'light' });
          }
        };
        
        mediaQuery.addEventListener('change', handleSystemThemeChange);
        return () => mediaQuery.removeEventListener('change', handleSystemThemeChange);
      } catch (error) {
        console.error('Failed to load theme preferences:', error);
      } finally {
        setIsLoading(false);
      }
    };

    loadThemePreferences();
  }, []);

  // Application du thème au DOM
  useEffect(() => {
    applyThemeToDOM(theme);
    
    // Sauvegarde des préférences
    localStorage.setItem('bas-malin-theme', JSON.stringify(theme));
  }, [theme]);

  const setTheme = (updates: Partial<ThemeConfig>) => {
    setThemeState(prev => ({ ...prev, ...updates }));
  };

  const toggleMode = () => {
    setTheme({
      mode: theme.mode === 'light' ? 'dark' : 'light'
    });
  };

  return (
    <ThemeContext.Provider value={{ theme, setTheme, toggleMode, isLoading }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within ThemeProvider');
  }
  return context;
}

// Application effective du thème
function applyThemeToDOM(theme: ThemeConfig) {
  const root = document.documentElement;
  
  // Mode sombre/clair
  const effectiveMode = theme.mode === 'auto' 
    ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
    : theme.mode;
  
  root.setAttribute('data-theme', effectiveMode);
  root.setAttribute('data-size', theme.size);
  root.setAttribute('data-contrast', theme.contrast);
  
  // Variables CSS dynamiques
  root.style.setProperty('--color-primary', theme.primaryColor);
  
  // Tailles selon le mode
  const sizeMultipliers = {
    compact: 0.875,
    comfortable: 1,
    large: 1.125
  };
  
  const multiplier = sizeMultipliers[theme.size];
  root.style.setProperty('--size-multiplier', multiplier.toString());
  
  // Contraste élevé
  if (theme.contrast === 'high') {
    root.style.setProperty('--contrast-boost', '1.2');
  } else {
    root.style.setProperty('--contrast-boost', '1');
  }
}
```

### Composants UI Fondamentaux

```typescript
// src/design-system/components/Button/Button.tsx
import { forwardRef } from 'react';
import { Slot } from '@radix-ui/react-slot';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '@/lib/utils';

const buttonVariants = cva(
  [
    // Base styles
    'inline-flex items-center justify-center rounded-md text-sm font-medium',
    'transition-all duration-200 focus-visible:outline-none focus-visible:ring-2',
    'focus-visible:ring-primary-500 focus-visible:ring-offset-2',
    'disabled:pointer-events-none disabled:opacity-50',
    'relative overflow-hidden',
    
    // Micro-animations
    'transform hover:scale-[1.02] active:scale-[0.98]',
    'hover:shadow-md active:shadow-sm',
  ],
  {
    variants: {
      variant: {
        default: [
          'bg-primary-500 text-white shadow',
          'hover:bg-primary-600 active:bg-primary-700',
          'dark:bg-primary-600 dark:hover:bg-primary-700'
        ],
        destructive: [
          'bg-error-500 text-white shadow',
          'hover:bg-error-600 active:bg-error-700'
        ],
        outline: [
          'border border-gray-300 bg-transparent shadow-sm',
          'hover:bg-gray-50 hover:border-gray-400',
          'dark:border-gray-600 dark:hover:bg-gray-800'
        ],
        secondary: [
          'bg-secondary-100 text-secondary-900 shadow-sm',
          'hover:bg-secondary-200 active:bg-secondary-300',
          'dark:bg-secondary-800 dark:text-secondary-100'
        ],
        ghost: [
          'bg-transparent shadow-none',
          'hover:bg-gray-100 active:bg-gray-200',
          'dark:hover:bg-gray-800'
        ],
        link: [
          'text-primary-500 underline-offset-4 shadow-none',
          'hover:underline hover:text-primary-600'
        ]
      },
      size: {
        sm: 'h-8 px-3 text-xs',
        default: 'h-10 px-4 py-2',
        lg: 'h-12 px-6 text-base',
        xl: 'h-14 px-8 text-lg',
        icon: 'h-10 w-10 p-0'
      },
      fullWidth: {
        true: 'w-full'
      }
    },
    defaultVariants: {
      variant: 'default',
      size: 'default'
    }
  }
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
  loading?: boolean;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  ({
    className,
    variant,
    size,
    fullWidth,
    asChild = false,
    loading = false,
    leftIcon,
    rightIcon,
    children,
    disabled,
    ...props
  }, ref) => {
    const Comp = asChild ? Slot : 'button';
    
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, fullWidth, className }))}
        ref={ref}
        disabled={disabled || loading}
        {...props}
      >
        {loading && (
          <div className="absolute inset-0 flex items-center justify-center">
            <div className="animate-spin rounded-full h-4 w-4 border-2 border-current border-t-transparent" />
          </div>
        )}
        
        <span className={cn('flex items-center gap-2', loading && 'opacity-0')}>
          {leftIcon && <span className="flex-shrink-0">{leftIcon}</span>}
          {children}
          {rightIcon && <span className="flex-shrink-0">{rightIcon}</span>}
        </span>
      </Comp>
    );
  }
);

Button.displayName = 'Button';

export { Button, buttonVariants };
```

```typescript
// src/design-system/components/Card/Card.tsx
import { forwardRef } from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '@/lib/utils';

const cardVariants = cva(
  [
    'rounded-lg border bg-white shadow-sm transition-all duration-200',
    'dark:bg-gray-900 dark:border-gray-800'
  ],
  {
    variants: {
      variant: {
        default: 'border-gray-200',
        elevated: 'shadow-md hover:shadow-lg',
        outlined: 'border-2 border-primary-200 dark:border-primary-800',
        filled: 'bg-gray-50 border-gray-200 dark:bg-gray-800',
        glass: 'bg-white/80 backdrop-blur-sm border-white/20 dark:bg-gray-900/80'
      },
      padding: {
        none: 'p-0',
        sm: 'p-3',
        default: 'p-4',
        lg: 'p-6',
        xl: 'p-8'
      },
      interactive: {
        true: 'cursor-pointer hover:shadow-md hover:-translate-y-0.5'
      }
    },
    defaultVariants: {
      variant: 'default',
      padding: 'default'
    }
  }
);

export interface CardProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof cardVariants> {}

const Card = forwardRef<HTMLDivElement, CardProps>(
  ({ className, variant, padding, interactive, ...props }, ref) => (
    <div
      ref={ref}
      className={cn(cardVariants({ variant, padding, interactive, className }))}
      {...props}
    />
  )
);

const CardHeader = forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn('flex flex-col space-y-1.5 pb-4', className)}
      {...props}
    />
  )
);

const CardTitle = forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, children, ...props }, ref) => (
    <h3
      ref={ref}
      className={cn('text-lg font-semibold leading-none tracking-tight', className)}
      {...props}
    >
      {children}
    </h3>
  )
);

const CardDescription = forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => (
    <p
      ref={ref}
      className={cn('text-sm text-gray-600 dark:text-gray-400', className)}
      {...props}
    />
  )
);

const CardContent = forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn('', className)} {...props} />
  )
);

const CardFooter = forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn('flex items-center pt-4', className)}
      {...props}
    />
  )
);

Card.displayName = 'Card';
CardHeader.displayName = 'CardHeader';
CardTitle.displayName = 'CardTitle';
CardDescription.displayName = 'CardDescription';
CardContent.displayName = 'CardContent';
CardFooter.displayName = 'CardFooter';

export {
  Card,
  CardHeader,
  CardTitle,
  CardDescription,
  CardContent,
  CardFooter
};
```

### Composants Spécialisés Jardin

```typescript
// src/design-system/components/garden/PlantCard/PlantCard.tsx
import { Card, CardContent } from '@/design-system/components/Card';
import { Badge } from '@/design-system/components/Badge';
import { Button } from '@/design-system/components/Button';
import { PlantHealthIndicator } from './PlantHealthIndicator';
import { WaterDropIcon, SunIcon, ThermometerIcon } from '@/icons';

export interface PlantCardProps {
  plant: {
    id: string;
    name: string;
    variety: string;
    imageUrl?: string;
    health: 'excellent' | 'good' | 'warning' | 'critical';
    lastWatered: Date;
    nextHarvest?: Date;
    temperature: number;
    humidity: number;
    sunExposure: number;
  };
  onWater?: () => void;
  onHarvest?: () => void;
  onViewDetails?: () => void;
  variant?: 'mobile' | 'desktop' | 'tv';
}

export function PlantCard({ 
  plant, 
  onWater, 
  onHarvest, 
  onViewDetails,
  variant = 'mobile'
}: PlantCardProps) {
  const isTV = variant === 'tv';
  const isDesktop = variant === 'desktop';
  
  return (
    <Card 
      variant="elevated" 
      interactive 
      className={cn(
        'overflow-hidden',
        isTV && 'p-8 rounded-2xl',
        isDesktop && 'p-6'
      )}
      onClick={onViewDetails}
    >
      {/* Image de la plante */}
      {plant.imageUrl && (
        <div className={cn(
          'relative overflow-hidden bg-gradient-to-br from-green-100 to-blue-100',
          isTV ? 'h-48 rounded-xl mb-6' : 'h-32 rounded-lg mb-4'
        )}>
          <img
            src={plant.imageUrl}
            alt={plant.name}
            className="w-full h-full object-cover"
          />
          <PlantHealthIndicator 
            health={plant.health}
            className="absolute top-2 right-2"
            size={isTV ? 'lg' : 'default'}
          />
        </div>
      )}
      
      <CardContent className="space-y-3">
        {/* Informations principales */}
        <div>
          <h3 className={cn(
            'font-semibold text-gray-900 dark:text-white',
            isTV ? 'text-2xl' : isDesktop ? 'text-lg' : 'text-base'
          )}>
            {plant.name}
          </h3>
          <p className={cn(
            'text-gray-600 dark:text-gray-400',
            isTV ? 'text-lg' : 'text-sm'
          )}>
            {plant.variety}
          </p>
        </div>
        
        {/* Métriques environnementales */}
        <div className={cn(
          'grid gap-2',
          isTV ? 'grid-cols-3 gap-4' : 'grid-cols-3'
        )}>
          <div className="flex items-center space-x-1">
            <ThermometerIcon className={cn(
              'text-orange-500',
              isTV ? 'w-6 h-6' : 'w-4 h-4'
            )} />
            <span className={cn(
              'text-xs font-medium',
              isTV && 'text-base'
            )}>
              {plant.temperature}°C
            </span>
          </div>
          
          <div className="flex items-center space-x-1">
            <WaterDropIcon className={cn(
              'text-blue-500',
              isTV ? 'w-6 h-6' : 'w-4 h-4'
            )} />
            <span className={cn(
              'text-xs font-medium',
              isTV && 'text-base'
            )}>
              {plant.humidity}%
            </span>
          </div>
          
          <div className="flex items-center space-x-1">
            <SunIcon className={cn(
              'text-yellow-500',
              isTV ? 'w-6 h-6' : 'w-4 h-4'
            )} />
            <span className={cn(
              'text-xs font-medium',
              isTV && 'text-base'
            )}>
              {plant.sunExposure}h
            </span>
          </div>
        </div>
        
        {/* Badges d'état */}
        <div className="flex gap-2 flex-wrap">
          {plant.nextHarvest && (
            <Badge variant="success" size={isTV ? 'default' : 'sm'}>
              Récolte {formatDistanceToNow(plant.nextHarvest, { locale: fr })}
            </Badge>
          )}
          
          <Badge variant="outline" size={isTV ? 'default' : 'sm'}>
            Arrosé {formatDistanceToNow(plant.lastWatered, { locale: fr })}
          </Badge>
        </div>
        
        {/* Actions */}
        {!isTV && (
          <div className="flex gap-2 pt-2">
            {onWater && (
              <Button
                size={isDesktop ? 'default' : 'sm'}
                variant="outline"
                onClick={(e) => {
                  e.stopPropagation();
                  onWater();
                }}
                leftIcon={<WaterDropIcon className="w-4 h-4" />}
              >
                Arroser
              </Button>
            )}
            
            {onHarvest && plant.nextHarvest && (
              <Button
                size={isDesktop ? 'default' : 'sm'}
                onClick={(e) => {
                  e.stopPropagation();
                  onHarvest();
                }}
              >
                Récolter
              </Button>
            )}
          </div>
        )}
      </CardContent>
    </Card>
  );
}

// Indicateur de santé des plantes
export function PlantHealthIndicator({ 
  health, 
  className, 
  size = 'default' 
}: {
  health: 'excellent' | 'good' | 'warning' | 'critical';
  className?: string;
  size?: 'sm' | 'default' | 'lg';
}) {
  const sizeClasses = {
    sm: 'w-3 h-3',
    default: 'w-4 h-4',
    lg: 'w-6 h-6'
  };
  
  const healthConfig = {
    excellent: { color: 'bg-green-500', pulse: false },
    good: { color: 'bg-green-400', pulse: false },
    warning: { color: 'bg-yellow-500', pulse: true },
    critical: { color: 'bg-red-500', pulse: true }
  };
  
  const config = healthConfig[health];
  
  return (
    <div className={cn('flex items-center justify-center', className)}>
      <div
        className={cn(
          'rounded-full border-2 border-white shadow-lg',
          sizeClasses[size],
          config.color,
          config.pulse && 'animate-pulse'
        )}
      />
    </div>
  );
}
```

## Responsive Design & Adaptation

```typescript
// src/design-system/hooks/useResponsive.ts
import { useEffect, useState } from 'react';
import { designTokens } from '../tokens';

export type Breakpoint = 'xs' | 'sm' | 'md' | 'lg' | 'xl' | '2xl' | 'tv';
export type DeviceType = 'mobile' | 'tablet' | 'desktop' | 'tv';

export function useResponsive() {
  const [currentBreakpoint, setCurrentBreakpoint] = useState<Breakpoint>('md');
  const [deviceType, setDeviceType] = useState<DeviceType>('desktop');
  const [screenSize, setScreenSize] = useState({ width: 0, height: 0 });

  useEffect(() => {
    const updateBreakpoint = () => {
      const width = window.innerWidth;
      const height = window.innerHeight;
      
      setScreenSize({ width, height });
      
      // Détermination du breakpoint
      if (width >= 1920) {
        setCurrentBreakpoint('tv');
        setDeviceType('tv');
      } else if (width >= 1536) {
        setCurrentBreakpoint('2xl');
        setDeviceType('desktop');
      } else if (width >= 1280) {
        setCurrentBreakpoint('xl');
        setDeviceType('desktop');
      } else if (width >= 1024) {
        setCurrentBreakpoint('lg');
        setDeviceType('desktop');
      } else if (width >= 768) {
        setCurrentBreakpoint('md');
        setDeviceType('tablet');
      } else if (width >= 640) {
        setCurrentBreakpoint('sm');
        setDeviceType('mobile');
      } else {
        setCurrentBreakpoint('xs');
        setDeviceType('mobile');
      }
    };

    updateBreakpoint();
    window.addEventListener('resize', updateBreakpoint);
    return () => window.removeEventListener('resize', updateBreakpoint);
  }, []);

  const isBreakpoint = (breakpoint: Breakpoint) => currentBreakpoint === breakpoint;
  const isMinBreakpoint = (breakpoint: Breakpoint) => {
    const breakpoints: Breakpoint[] = ['xs', 'sm', 'md', 'lg', 'xl', '2xl', 'tv'];
    const currentIndex = breakpoints.indexOf(currentBreakpoint);
    const targetIndex = breakpoints.indexOf(breakpoint);
    return currentIndex >= targetIndex;
  };

  return {
    currentBreakpoint,
    deviceType,
    screenSize,
    isBreakpoint,
    isMinBreakpoint,
    isMobile: deviceType === 'mobile',
    isTablet: deviceType === 'tablet',
    isDesktop: deviceType === 'desktop',
    isTV: deviceType === 'tv'
  };
}

// Hook pour adaptation automatique des composants
export function useAdaptiveComponent<T extends Record<DeviceType, any>>(
  variants: T
): T[DeviceType] {
  const { deviceType } = useResponsive();
  return variants[deviceType];
}
```

## Documentation Interactive

```typescript
// src/design-system/docs/Storybook.tsx
import type { Meta, StoryObj } from '@storybook/react';
import { Button } from '../components/Button';
import { ThemeProvider } from '../themes/theme-provider';

const meta: Meta<typeof Button> = {
  title: 'Design System/Button',
  component: Button,
  decorators: [
    (Story) => (
      <ThemeProvider>
        <div className="p-4">
          <Story />
        </div>
      </ThemeProvider>
    ),
  ],
  parameters: {
    layout: 'centered',
    docs: {
      description: {
        component: 'Composant Button polyvalent avec support multi-device et accessibilité complète.'
      }
    }
  },
  argTypes: {
    variant: {
      control: 'select',
      options: ['default', 'destructive', 'outline', 'secondary', 'ghost', 'link']
    },
    size: {
      control: 'select',
      options: ['sm', 'default', 'lg', 'xl', 'icon']
    }
  }
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    children: 'Bouton par défaut'
  }
};

export const Variants: Story = {
  render: () => (
    <div className="flex gap-4 flex-wrap">
      <Button variant="default">Default</Button>
      <Button variant="destructive">Destructive</Button>
      <Button variant="outline">Outline</Button>
      <Button variant="secondary">Secondary</Button>
      <Button variant="ghost">Ghost</Button>
      <Button variant="link">Link</Button>
    </div>
  )
};

export const Sizes: Story = {
  render: () => (
    <div className="flex items-center gap-4 flex-wrap">
      <Button size="sm">Small</Button>
      <Button size="default">Default</Button>
      <Button size="lg">Large</Button>
      <Button size="xl">Extra Large</Button>
      <Button size="icon">🌱</Button>
    </div>
  )
};

export const States: Story = {
  render: () => (
    <div className="grid grid-cols-2 gap-4">
      <Button>Normal</Button>
      <Button loading>Loading</Button>
      <Button disabled>Disabled</Button>
      <Button leftIcon={<span>🌱</span>}>Avec icône</Button>
    </div>
  )
};

export const Responsive: Story = {
  render: () => (
    <div className="space-y-4">
      <h3 className="text-lg font-semibold">Adaptation Mobile/Desktop/TV</h3>
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <div className="p-4 border rounded">
          <h4 className="font-medium mb-2">Mobile</h4>
          <Button fullWidth size="sm">Bouton Mobile</Button>
        </div>
        <div className="p-4 border rounded">
          <h4 className="font-medium mb-2">Desktop</h4>
          <Button size="default">Bouton Desktop</Button>
        </div>
        <div className="p-4 border rounded">
          <h4 className="font-medium mb-2">TV</h4>
          <Button size="xl">Bouton TV</Button>
        </div>
      </div>
    </div>
  )
};
```

## Critères d'Acceptation Techniques

### Accessibilité
- [ ] Conformité WCAG 2.1 AA à 100%
- [ ] Navigation clavier complète
- [ ] Support lecteurs d'écran
- [ ] Contraste couleurs > 4.5:1
- [ ] Tests automatisés accessibilité

### Performance
- [ ] Bundle CSS < 50KB gzippé
- [ ] Tree-shaking des composants non utilisés
- [ ] Lazy loading des variantes TV
- [ ] Temps de rendu initial < 100ms

### Consistance
- [ ] Design tokens centralisés
- [ ] Variantes cohérentes cross-device
- [ ] Documentation à jour pour tous les composants
- [ ] Tests visuels automatisés

## Couverture Exigences Architecture

- **EXG-001.3** : Interface adaptative multi-device
- **EXG-003.1** : Design responsive avec breakpoints optimisés
- **EXG-003.2** : Accessibilité WCAG 2.1 AA
- **EXG-003.3** : Thèmes sombre/clair avec persistance
- **EXG-007.2** : PWA avec interface native
- **EXG-009.2** : Performance optimisée

## Tests d'Acceptation

```typescript
// tests/design-system/components.test.tsx
describe('Design System Components', () => {
  test('Button respecte les variants et tailles', () => {
    render(<Button variant="outline" size="lg">Test</Button>);
    
    const button = screen.getByRole('button');
    expect(button).toHaveClass('border');
    expect(button).toHaveClass('h-12');
  });

  test('PlantCard adapte selon device type', () => {
    const mockPlant = createMockPlant();
    
    render(<PlantCard plant={mockPlant} variant="tv" />);
    
    expect(screen.getByText(mockPlant.name)).toHaveClass('text-2xl');
  });

  test('Theme provider applique thème correctement', () => {
    render(
      <ThemeProvider>
        <div data-testid="themed-element">Content</div>
      </ThemeProvider>
    );
    
    expect(document.documentElement).toHaveAttribute('data-theme');
  });
});

// tests/accessibility/wcag.test.tsx  
describe('WCAG Compliance', () => {
  test('tous les composants respectent contraste minimum', async () => {
    const { container } = render(<ComponentShowcase />);
    
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('navigation clavier fonctionne', async () => {
    render(<NavigationTest />);
    
    await userEvent.tab();
    expect(screen.getByRole('button', { name: 'Premier' })).toHaveFocus();
    
    await userEvent.tab();
    expect(screen.getByRole('button', { name: 'Deuxième' })).toHaveFocus();
  });
});
```

Cette spécification établit un design system complet et cohérent qui assure une expérience utilisateur excellente sur tous les appareils tout en respectant les standards d'accessibilité et de performance.